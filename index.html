<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>3D GO - Sua loja de impressão 3D</title>
  <style>
    /* Estilo Global */
    body {
      font-family: Arial, sans-serif;
      background-color: #ffffff; /* Fundo branco */
      color: #000000; /* Texto preto */
      margin: 0;
      padding: 0;
    }

    /* Cabeçalho */
    header {
      background-color: #ff0000; /* Fundo vermelho */
      color: #ffffff; /* Texto branco */
      padding: 20px;
      text-align: center;
    }

    header h1 {
      margin: 0;
      font-size: 2.5em;
    }

    /* Formulário */
    .container {
      padding: 20px;
      text-align: center;
    }

    .input-file {
      background-color: #ff0000; /* Botão vermelho */
      color: white;
      border: none;
      padding: 10px 20px;
      font-size: 16px;
      cursor: pointer;
      border-radius: 5px;
      margin: 10px;
    }

    .input-file:hover {
      background-color: #cc0000; /* Vermelho escuro no hover */
    }

    .info {
      margin-top: 20px;
      font-size: 1.2em;
    }

    /* Visualização 3D */
    #preview {
      width: 100%;
      height: 500px;
      margin-top: 20px;
      border: 2px solid #ff0000; /* Borda vermelha ao redor da visualização */
    }

    footer {
      background-color: #ff0000; /* Fundo vermelho */
      color: #ffffff; /* Texto branco */
      text-align: center;
      padding: 10px;
      position: absolute;
      width: 100%;
      bottom: 0;
    }

    footer p {
      margin: 0;
    }
  </style>
</head>
<body>
  <header>
    <h1>3D GO - Sua Loja de Impressão 3D</h1>
  </header>

  <div class="container">
    <h2>Carregue seu arquivo STL</h2>
    <input type="file" id="stlFile" class="input-file" accept=".stl, .3mf">
    <div id="preview"></div>

    <div class="info">
      <p>Volume: <span id="volume">0</span> cm³</p>
      <p>Preço: R$ <span id="price">0</span></p>
    </div>
  </div>

  <footer>
    <p>© 2025 3D GO - Impressão 3D Personalizada</p>
  </footer>

  <script type="text/javascript" src="https://cdn.emailjs.com/dist/email.min.js"></script>

  <script src="https://unpkg.com/three@0.150.1/build/three.module.js"></script>
  <script src="https://unpkg.com/three@0.150.1/examples/jsm/loaders/STLLoader.js"></script>
  <script src="https://unpkg.com/three@0.150.1/examples/jsm/controls/OrbitControls.js"></script>

  <script>
    let scene, camera, renderer, controls, mesh;

    function init() {
      const container = document.getElementById('preview');
      scene = new THREE.Scene();
      camera = new THREE.PerspectiveCamera(75, container.clientWidth / container.clientHeight, 0.1, 1000);
      camera.position.set(0, 0, 100);

      renderer = new THREE.WebGLRenderer({ antialias: true });
      renderer.setSize(container.clientWidth, container.clientHeight);
      container.appendChild(renderer.domElement);

      controls = new OrbitControls(camera, renderer.domElement);
      controls.enableDamping = true;
      controls.dampingFactor = 0.05;

      const light = new THREE.DirectionalLight(0xffffff, 1);
      light.position.set(0, 0, 100).normalize();
      scene.add(light);

      animate();
    }

    function animate() {
      requestAnimationFrame(animate);
      controls.update();
      renderer.render(scene, camera);
    }

    document.getElementById('stlFile').addEventListener('change', function (event) {
      const file = event.target.files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onload = function (e) {
        const loader = new STLLoader();
        const geometry = loader.parse(e.target.result);
        geometry.center();

        const material = new THREE.MeshStandardMaterial({ color: 0x2194ce });
        if (mesh) scene.remove(mesh);
        mesh = new THREE.Mesh(geometry, material);
        scene.add(mesh);

        // Calcular volume
        const volume = calculateVolume(geometry);
        document.getElementById('volume').textContent = volume.toFixed(2);
        document.getElementById('price').textContent = (volume * 0.5).toFixed(2);

        // Enviar email com os dados
        sendEmail(volume, (volume * 0.5).toFixed(2));
      };
      reader.readAsArrayBuffer(file);
    });

    function calculateVolume(geometry) {
      let position = geometry.attributes.position;
      let sum = 0;
      for (let i = 0; i < position.count; i += 3) {
        const ax = position.getX(i);
        const ay = position.getY(i);
        const az = position.getZ(i);
        const bx = position.getX(i + 1);
        const by = position.getY(i + 1);
        const bz = position.getZ(i + 1);
        const cx = position.getX(i + 2);
        const cy = position.getY(i + 2);
        const cz = position.getZ(i + 2);

        sum += signedVolumeOfTriangle(ax, ay, az, bx, by, bz, cx, cy, cz);
      }
      return Math.abs(sum) / 1000; // Convert mm³ to cm³
    }

    function signedVolumeOfTriangle(ax, ay, az, bx, by, bz, cx, cy, cz) {
      return (1.0 / 6.0) * (
        ax * (by * cz - bz * cy) -
        ay * (bx * cz - bz * cx) +
        az * (bx * cy - by * cx)
      );
    }

    // Função para enviar e-mail
    function sendEmail(volume, price) {
      emailjs.init("45ZVb6pBbMGwIVhyo"); // Substitua pelo seu User ID do EmailJS
      const templateParams = {
        to_email: "franciscobraganca2010@gmail.com", // Substitua pelo seu e-mail
        volume: volume,
        price: price,
      };

      emailjs.send("service_utkxrne", "template_959sfoi", templateParams)
        .then(function(response) {
          console.log("Sucesso ao enviar o e-mail:", response);
        }, function(error) {
          console.error("Erro ao enviar o e-mail:", error);
        });
    }

    init();
  </script>
</body>
</html>
