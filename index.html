<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D GO - Orçamento de Impressão 3D</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/emailjs-com@2.6.4/dist/email.min.js"></script>
</head>
<body>
    <h1>3D GO - Sua loja de impressão 3D</h1>
    
    <label for="fileInput">Escolha seu arquivo STL:</label>
    <input type="file" id="fileInput" accept=".stl,.obj,.3mf,.amf">
    <br><br>

    <h3>Preview do Modelo 3D:</h3>
    <div id="modelPreview" style="width: 500px; height: 500px;"></div>
    
    <br>
    <p>Volume: <span id="volume">0</span> cm³</p>
    <p>Preço: R$ <span id="price">0.00</span></p>
    
    <h3>Informações do Pedido:</h3>
    <form id="orderForm">
        <label for="name">Nome:</label>
        <input type="text" id="name" required><br><br>
        
        <label for="email">E-mail:</label>
        <input type="email" id="email" required><br><br>
        
        <label for="message">Descrição:</label>
        <textarea id="message" rows="4" cols="50" required></textarea><br><br>

        <button type="submit">Enviar Pedido</button>
    </form>
    
    <script>
        emailjs.init('YOUR_USER_ID'); // Substitua pelo seu User ID do EmailJS

        let scene, camera, renderer, model;
        let fileInput = document.getElementById('fileInput');
        let volumeElement = document.getElementById('volume');
        let priceElement = document.getElementById('price');
        let pricePerCm3 = 0.50; // R$0,50 por cm³

        function init() {
            scene = new THREE.Scene();
            camera = new THREE.PerspectiveCamera(75, 1, 0.1, 1000);
            renderer = new THREE.WebGLRenderer();
            renderer.setSize(500, 500);
            document.getElementById('modelPreview').appendChild(renderer.domElement);

            let light = new THREE.AmbientLight(0x404040);
            scene.add(light);
            camera.position.z = 5;
        }

        function loadModel(file) {
            let reader = new FileReader();
            reader.onload = function(event) {
                let loader = new THREE.STLLoader();
                let geometry = loader.parse(event.target.result);
                let material = new THREE.MeshBasicMaterial({ color: 0x00ff00 });
                model = new THREE.Mesh(geometry, material);
                scene.add(model);
                calculateVolume(geometry);
                animate();
            };
            reader.readAsArrayBuffer(file);
        }

        function calculateVolume(geometry) {
            let volume = geometry.computeBoundingBox();
            let volumeCm3 = volume.max.x * volume.max.y * volume.max.z; // Simples cálculo de volume
            volumeElement.innerText = volumeCm3.toFixed(2);
            let price = volumeCm3 * pricePerCm3;
            priceElement.innerText = price.toFixed(2);
        }

        function animate() {
            requestAnimationFrame(animate);
            model.rotation.x += 0.01;
            model.rotation.y += 0.01;
            renderer.render(scene, camera);
        }

        fileInput.addEventListener('change', function() {
            loadModel(fileInput.files[0]);
        });

        document.getElementById('orderForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            let formData = {
                name: document.getElementById('name').value,
                email: document.getElementById('email').value,
                message: document.getElementById('message').value,
                file_link: URL.createObjectURL(fileInput.files[0]) // Link do arquivo STL
            };

            emailjs.send('YOUR_SERVICE_ID', 'YOUR_TEMPLATE_ID', formData)
                .then(function(response) {
                    alert('Pedido enviado com sucesso!');
                }, function(error) {
                    alert('Erro ao enviar pedido: ' + error);
                });
        });

        init();
    </script>
</body>
</html>
